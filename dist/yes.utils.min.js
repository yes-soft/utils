"use strict";angular.module("yes.utils",[]),angular.module("yes.utils").factory("authInterceptor",["$rootScope","$q","$window","$location",function(e,t,r,n){var i=!0;return{request:function(e){return e},response:function(e){return e||t.when(e)},responseError:function(e){return 401===e.status&&i&&(i=!1,n.path("/login").search("return",encodeURIComponent(location.hash)),setTimeout(function(){i=!0},12e3)),t.reject(e)}}}]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.interceptors.push("authInterceptor")}]),angular.module("yes.utils").factory("explain",["$stateParams","oPath","ENV","plugins","utils",function(e,t,r,n,i){var o=angular.element(document.body).injector(),a=function(e,t){for(var r={},n=0;n<e.length;++n)e[n].hasOwnProperty(t)?r[e[n][t]]=e[n]:r[n]=e[n];return r},u=function(e,t){try{return o.get(e+".config")[t]}catch(r){return null}},l=function(e,t){angular.isFunction(e)?o.invoke(e,t):angular.isArray(e)&&angular.forEach(e,function(e){l(e,t)})},c=function(e,r){var n=t.get(e,"operation",[]);if(!n)return e;var i=[],a={add:{name:"新建",action:r.action.create},del:{name:"删除",action:r.action.del}},u={scope:r};return angular.forEach(n,function(e,t){if(e){var r=a[t]||{name:e.name,action:e.action};angular.isFunction(e.action)&&(r.action=function(){o.invoke(e.action,u)}),i.push(r)}}),e.operations=i,e},f=function(e,r){var n={scope:r,list:e.list},i=t.get(e,"list.resolves",[]);return l(i,n),e},s=function(e,t,r){e&&(e[t]=e[t]||angular.copy(r))},p=function(e,t){if(!e)throw"can not override properties with null";for(var r in t)t.hasOwnProperty(r)&&s(e,r,t[r])},g=function(e,r){var n=t.get(e,"schema.properties",{});angular.isArray(n)&&(e.schema.properties=a(n,"key"));var i={scope:r,form:e.form};angular.isArray(e.form)&&angular.forEach(e.form,function(t){angular.forEach(t.items,function(t){("datepicker"==t.type||"datetimepicker"==t.type)&&(t.title=t.title||e.schema.properties[t.key].title,t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0}),angular.isObject(t)&&(t.required=t.required||e.schema.properties[t.key].required)})});var o=t.get(e,"resolves",[]);return l(o,i),e},d=function(t){if(!angular.isUndefined(t)){if(0==t.indexOf("http")||t.indexOf("plugins")>-1)return t;var n=[r.pluginFolder,e.name,"templates",t].join("/").replace(/\/\//g,"/");return[i.root,n].join("/")}},h=function(){var t=u(e.name,"_default")||{};return t=angular.extend({list:{},form:{}},t),s(t.form,"template",[i.root,n.templates.detail].join("/")),s(t.list,"template",[i.root,n.templates.list].join("/")),s(t.list,"pageSize",r.pageSize["default"]),t};return{configuration:function(t){var r=h(),n=u(e.name,e.page)||{};return s(n,"form",{}),s(n,"list",{}),p(n.form,r.form),p(n.list,r.list),n.list.template=d(n.list.template),n.form.template=d(n.form.template),n=c(n,t),n=f(n,t),n.form=g(n.form,t),n}}}]),angular.module("yes.utils").factory("fileSize",function(){function e(e,t){return e&&e.toLowerCase()===t.toLowerCase()}var t="BKMGTPEZY".split("");return function(r,n){return r="number"==typeof r?r:0,n=n||{},n.fixed="number"==typeof n.fixed?n.fixed:2,n.spacer="string"==typeof n.spacer?n.spacer:" ",n.calculate=function(t){var i,o=e(t,"si")?["k","B"]:["K","iB"],a=e(t,"si")?1e3:1024,u=Math.log(r)/Math.log(a)|0,l=r/Math.pow(a,u),c=l.toFixed(n.fixed);return 3>u-1&&!e(t,"si")&&e(t,"jedec")&&(o[1]="B"),i=u?(o[0]+"MGTPEZY")[u-1]+o[1]:1===(0|c)?"Byte":"Bytes",{suffix:i,magnitude:u,result:l,fixed:c,bits:{result:l/8,fixed:(l/8).toFixed(n.fixed)}}},n.to=function(n,i){var o=e(i,"si")?1e3:1024,a=t.indexOf("string"==typeof n?n[0].toUpperCase():"B"),u=r;if(-1===a||0===a)return u.toFixed(2);for(;a>0;a--)u/=o;return u.toFixed(2)},n.human=function(e){var t=n.calculate(e);return t.fixed+n.spacer+t.suffix},n}}),angular.module("yes.utils").factory("menu",["$http","$q","$location","utils",function(e,t,r,n){var i={},o=n.settings||{},a=function(e,t,r){if(angular.isUndefined(e))return[];e.parents=e.parents||[];var n=r.filter(function(e){return e.uid==t.parent});0==e.parents.length&&e.parents.push(e.label),n.length&&(e.parents.push(n[0].name),a(e,n[0],r))},u=function(e){(angular.isUndefined(e.url)||"#"==e.url)&&(e.url=""),0===e.url.indexOf("/")&&angular.isDefined(o.serverRoot)&&(e.url=o.serverRoot+e.url)},l=function(e){angular.forEach(e,function(e){e.hasOwnProperty("parent")&&angular.isString(e.parent)&&(i[e.parent]=i[e.parent]||[],e.subMenus=i[e.parent]),u(e),e.parent==e.uid&&e.type&&"menu"==e.type.toLowerCase()&&i[e.parent].push(e)})},c=function(e,t){return l(t),t.filter(function(t){return t.parent==e})};return{initMenus:c,buildMenuTree:function(e){var t=[];return angular.forEach(e,function(r){var n={label:r.name,url:r.url,parent:r.parent,uid:r.uid};a(n,n,e),n.name=n.parents.reverse().join(" > "),t.push(n)}),t}}}]),angular.module("yes.path").factory("oPath",[function(){var e;return e=function(){function e(e){if(!e)return!0;if(s(e)&&0===e.length)return!0;if(!c(e)){for(var t in e)if(u.call(e,t))return!1;return!0}return!1}function t(e){return a.call(e)}function r(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function n(e){var t=parseInt(e);return t.toString()===e?t:e}function i(t,r,o,a){if(l(r)&&(r=[r]),e(r))return t;if(c(r))return i(t,r.split(".").map(n),o,a);var u=r[0];if(1===r.length){var f=t[u];return void 0!==f&&a||(t[u]=o),f}return void 0===t[u]&&(t[u]=l(r[1])?[]:{}),i(t[u],r.slice(1),o,a)}function o(t,r){if(l(r)&&(r=[r]),e(t))return void 0;if(e(r))return t;if(c(r))return o(t,r.split("."));var i=n(r[0]),a=t[i];if(1===r.length)void 0!==a&&(s(t)?t.splice(i,1):delete t[i]);else if(void 0!==t[i])return o(t[i],r.slice(1));return t}var a=Object.prototype.toString,u=Object.prototype.hasOwnProperty,l=angular.isNumber,c=angular.isString,f=angular.isObject,s=angular.isArray,p=function(e){return Object.keys(p).reduce(function(t,r){return"function"==typeof p[r]&&(t[r]=p[r].bind(p,e)),t},{})};return p.has=function(t,r){if(e(t))return!1;if(l(r)?r=[r]:c(r)&&(r=r.split(".")),e(r)||0===r.length)return!1;for(var n=0;n<r.length;n++){var i=r[n];if(!f(t)&&!s(t)||!u.call(t,i))return!1;t=t[i]}return!0},p.ensureExists=function(e,t,r){return i(e,t,r,!0)},p.set=function(e,t,r,n){return i(e,t,r,n)},p.insert=function(e,t,r,n){var i=p.get(e,t);n=~~n,s(i)||(i=[],p.set(e,t,i)),i.splice(n,0,r)},p.empty=function(t,n){if(e(n))return t;if(e(t))return void 0;var i,o;if(!(i=p.get(t,n)))return t;if(c(i))return p.set(t,n,"");if(r(i))return p.set(t,n,!1);if(l(i))return p.set(t,n,0);if(s(i))i.length=0;else{if(!f(i))return p.set(t,n,null);for(o in i)u.call(i,o)&&delete i[o]}},p.push=function(e,t){var r=p.get(e,t);s(r)||(r=[],p.set(e,t,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},p.coalesce=function(e,t,r){for(var n,i=0,o=t.length;o>i;i++)if(void 0!==(n=p.get(e,t[i])))return n;return r},p.find=function(t,r,i){if(l(r)&&(r=[r]),e(r))return t;if(e(t))return i;c(r)&&p.find(t,r.split("."),i);var o=n(r[0]);if(/\[(.*?)\]/g.test(o)&&s(t))for(var a=/\[(.*?)\]/g.exec(o)[1],u=a.split(":"),f=0;f<t.length;f++)if(t[f].hasOwnProperty(u[0])&&t[f][u[0]]==u[1])return p.find(t[f],r.slice(1),i);return 1===r.length?void 0===t[o]?i:t[o]:p.find(t[o],r.slice(1),i)},p.get=function(t,r,i){if(l(r)&&(r=[r]),e(r))return t;if(e(t))return i;if(c(r))return p.get(t,r.split("."),i);var o=n(r[0]);return 1===r.length?void 0===t[o]?i:t[o]:p.get(t[o],r.slice(1),i)},p.del=function(e,t){return o(e,t)},p}()}]),angular.module("yes.utils").factory("utils",["$http","$q","$location","$stateParams","ENV","gateway","ngDialog",function(e,t,r,n,i,o,a){var u=i.headers,l={async:function(r,n,i,o){var a={method:r,url:n,cache:!1,headers:o||u};i&&angular.forEach(i,function(e,t){""==e&&delete i[t]}),i&&("post"==r.toLowerCase()||"put"==r.toLowerCase())&&u["Content-Type"].indexOf("json")>0?a.data=i:i&&(a.data=this.serialize(i));var l=t.defer();return n?(a.data&&"get"==a.method.toLowerCase()&&(a.url=a.url+"?"+a.data),e(a).success(function(e){0!=e.error&&e.error?l.reject(e.message?e:{message:"服务器异常"}):l.resolve(e)}).error(function(e){l.reject({message:"无法连接到服务器"})}),l.promise):void l.reject({message:"Uri is empty!"})},serialize:function(e){if(!angular.isObject(e))return null==e?"":e.toString();var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];angular.isDate(n)&&moment&&(n=moment(n).format("YYYY-MM-DD HH:mm:ss")),t.push(encodeURIComponent(r)+"="+encodeURIComponent(null==n?"":n))}var i=t.join("&");return i},createDoc:function(e){return e&&e.properties&&angular.isArray(e.properties)&&(angular.forEach(e.properties,function(t){e[t.name]=1==t.value.length?t.value[0]:t.value}),delete e.properties),e}},c={defaults:"ico ico-file ico-file-1",xls:"ico ico-file ico-file-2",xlsx:"ico ico-file ico-file-2",doc:"ico ico-file ico-file-3",docx:"ico ico-file ico-file-3",ppt:"ico ico-file ico-file-4",pptx:"ico ico-file ico-file-4",rar:"ico ico-file ico-file-6",zip:"ico ico-file ico-file-7",html:"ico ico-file ico-file-10",js:"ico ico-file ico-file-11",xml:"ico ico-file ico-file-12",css:"ico ico-file ico-file-12",pdf:"ico ico-file ico-file-17",txt:"ico ico-file ico-file-22",jpg:"ico ico-file ico-file-31",gif:"ico ico-file ico-file-32",png:"ico ico-file ico-file-33",bmp:"ico ico-file ico-file-34"},f=function(e,t){return t.filter(function(r){var n=r.parent==e&&r.type&&"menu"==r.type.toLowerCase();return"#"==r.url&&(r.url=""),0!=r.url.indexOf(i.serverRoot)&&0===r.url.indexOf("/")&&""!=i.serverRoot&&(r.url=i.serverRoot+r.url),n&&(r.subMenus=f(r.uid,t)),n})},s=function(e){var t=[];return angular.forEach(e,function(r){var n={label:r.name,url:r.url,parent:r.parent,uid:r.uid};n.parents=[],p(n,n,e),n.name=n.parents.reverse().join(" > "),t.push(n)}),t},p=function(e,t,r){var n=r.filter(function(e){return e.uid==t.parent});0==e.parents.length&&e.parents.push(e.label),n.length&&(e.parents.push(n[0].name),p(e,n[0],r))},g=function(){var e={};return{on:function(t,r){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]),e[t].push(r)}),this},once:function(t,r){return t.split(" ").forEach(function(t){e[t]=[],e[t].push(r)}),this},trigger:function(t,r){return angular.forEach(e[t],function(e){e.call(null,r)}),this}}},d=new g,h=function(e){try{return angular.element(document.body).injector().get(e)}catch(t){return null}},m="self"!==o.host?o.host:location.protocol+"//"+location.host,v=m+location.pathname.substr(0,location.pathname.lastIndexOf("/")),y=function(e){var t=e.split("/");return i.mock&&t.length?"data/"+t.slice(3).join(".")+".json":e},x=function(e){var t=e;return 0==e.indexOf("http")?t=e:(0!==e.indexOf(i.apiPath)&&(t=[i.apiPath,e].join("/").replace(/\/\//g,"/")),t=[m,t].join("/")),t};return{alert:function(e,t){console.log(e,t)},root:v,host:m,getAbsUrl:x,serialize:l.serialize,format:function(e){var t=Array.prototype.slice.call(arguments,1);return e?e.replace(/{(\d+)}/g,function(e,r){return"undefined"!=typeof t[r]?t[r]:e}):""},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},createEvents:function(){return new g},events:d,initMenus:f,buildMenuTree:s,changeTitle:function(e){d.trigger("changeTitle",e)},currentPage:function(){var e=r.search()[e];return parseInt(e)||1},async:function(e,t,r){var n=x(t);return n=y(n),l.async(e,n,r)},findViewConfig:function(e,t){return h(e+".config")[t]},disableScroll:function(){document.body.style.overflow="hidden",angular.element(window).trigger("resize")},resetScroll:function(){document.body.style.overflow=null,angular.element(window).trigger("resize")},getFileExtCss:function(e){var t=/(?:\.([^.]+))?$/,r=t.exec(e)[1];return c.hasOwnProperty(r)?c[r]:c.defaults},dialogUpload:function(e){a.open({template:"base/templates/dialog-container.html",controller:function(t){t.options=e}})}}}]);